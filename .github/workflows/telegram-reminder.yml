name: Telegram Reminder

on:
  workflow_dispatch:   # manual test
  schedule:
    - cron: "20 6 * * *"   # 08:20 Israel
    - cron: "0 8 * * *"    # 10:00 Israel
    - cron: "20 10 * * *"  # 12:20 Israel
    - cron: "0 12 * * *"   # 14:00 Israel
    - cron: "0 14 * * *"   # 16:00 Israel
    - cron: "0 16 * * *"   # 18:00 Israel

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:
      - name: Determine message
        id: choose
        run: |
          # Manual run â†’ send ping
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "msg=ping ðŸš€ Manual test worked!" >> "$GITHUB_OUTPUT"
            exit 0
          fi

          # Automatic â†’ choose message by UTC time
          HOUR=$(date -u +%H)
          MINUTE=$(date -u +%M)

          if [ "$HOUR:$MINUTE" = "06:20" ]; then
            MSG="×‘×•×§×¨ ×˜×•×‘ ××ž×™×¨ â˜€ï¸ ×¢×•×“ ×™×•× ×—×“×© ×‘×œ×™ ×¡×™×’×¨×™×•×ª. ×–×• ×”×ª×—×œ×” ×—×–×§×”."
          elif [ "$HOUR:$MINUTE" = "08:00" ]; then
            MSG="×¢×©×¨ ×‘×‘×•×§×¨ ðŸ’ª ×”×’×•×£ ×©×œ×š × ×§×™ ×™×•×ª×¨ ×ž×ž×” ×©×”×•× ×”×™×” ×ž×–×” ×©× ×™×."
          elif [ "$HOUR:$MINUTE" = "10:20" ]; then
            MSG="×¦×”×¨×™×™× ×ž×ª×§×¨×‘×™× ðŸŒ¤ï¸ ××ª×” ×©×•×œ×˜ ×‘×”×¨×’×œ â€” ×œ× ×”×”×¨×’×œ ×‘×š."
          elif [ "$HOUR:$MINUTE" = "12:00" ]; then
            MSG="14:00 â€” ×”×–×ž×Ÿ ×”×§×œ××¡×™ ×œ×¡×™×’×¨×™×”. ××‘×œ ××ª×” ×ž×•×›×™×— ×©×ª×‘× ×™×ª ×™×©× ×” ×œ× ×ž×—×–×™×§×” ××•×ª×š."
          elif [ "$HOUR:$MINUTE" = "14:00" ]; then
            MSG="16:00 ðŸ§  ×”×’×•×£ ×ž×—×¤×© ×”×¤×¡×§×”, ×œ× ×¡×™×’×¨×™×”. ××ª×” ×©× ×œ×‘ â€” ×•×–×” ×›×œ ×”×”×‘×“×œ."
          elif [ "$HOUR:$MINUTE" = "16:00" ]; then
            MSG="18:00 ðŸŒ™ ×¢×•×“ ×—×¦×™ ×™×•× ×¢×‘×¨ ×‘×œ×™ ×¢×™×©×•×Ÿ. ××ª×” ×‘×ª×”×œ×™×š ××ž×™×ª×™ â€” ×•×–×” ×ž×•×¨×’×©."
          else
            MSG="×ª×–×›×•×¨×ª âœ¨ ××ª×” ×œ× ×ž×¢×©×Ÿ. ×–×” ×¨×§ ×”×¨×’×œ ×©×ž×ª×¤×¨×§."
          fi

          echo "msg=$MSG" >> "$GITHUB_OUTPUT"

      - name: Send Telegram Message
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.CHAT_ID }}" \
            --data-urlencode "text=${{ steps.choose.outputs.msg }}"
